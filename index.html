<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Task Manager</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #333; }
    .section { margin-bottom: 20px; }
    .section h2 { color: #555; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    .item { background: #fafafa; padding: 10px; margin-bottom: 10px; border-left: 4px solid #4CAF50; }
    .item h3 { margin: 0; color: #2c3e50; }
    .item p { margin: 5px 0; color: #7f8c8d; }
    .item span { color: #7f8c8d; font-size: 0.9em; }
    .progress { width: 100%; background: #e0e0e0; border-radius: 5px; overflow: hidden; }
    .progress-bar { height: 15px; background: #4CAF50; text-align: right; color: white; padding-right: 5px; font-size: 0.8em; }
    input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Smart Task Manager</h1>
    <div class="section">
      <button onclick="toggleForm('goalForm')">Add Goal</button>
      <button onclick="toggleForm('projectForm')">Add Project</button>
      <button onclick="toggleForm('taskForm')">Add Task</button>
      <button onclick="exportData()">Export Data</button>
      <button onclick="importData()">Import Data</button>
    </div>

    <div class="section">
      <h2>Goals</h2>
      <div id="goals"></div>
      <form id="goalForm" class="hidden">
        <input type="text" id="goalTitle" placeholder="Goal Title" required><br>
        <textarea id="goalDescription" placeholder="Goal Description" rows="3"></textarea><br>
        <input type="date" id="goalDate"><br>
        <button type="button" onclick="saveGoal()">Save</button>
        <button type="button" onclick="toggleForm('goalForm')">Cancel</button>
      </form>
    </div>

    <div class="section">
      <h2>Projects</h2>
      <div id="projects"></div>
      <form id="projectForm" class="hidden">
        <input type="text" id="projectTitle" placeholder="Project Title" required><br>
        <textarea id="projectDescription" placeholder="Project Description" rows="3"></textarea><br>
        <input type="date" id="projectDate"><br>
        <select id="linkedGoal">
          <option value="">No Goal</option>
        </select><br>
        <button type="button" onclick="saveProject()">Save</button>
        <button type="button" onclick="toggleForm('projectForm')">Cancel</button>
      </form>
    </div>

    <div class="section">
      <h2>Tasks</h2>
      <div id="tasks"></div>
      <form id="taskForm" class="hidden">
        <input type="text" id="taskTitle" placeholder="Task Title" required><br>
        <input type="date" id="taskDate"><br>
        <select id="taskPriority">
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select><br>
        <select id="taskType">
          <option value="One-Time">One-Time</option>
          <option value="Recurring">Recurring</option>
        </select><br>
        <select id="linkedProject">
          <option value="">No Project</option>
        </select><br>
        <button type="button" onclick="saveTask()">Save</button>
        <button type="button" onclick="toggleForm('taskForm')">Cancel</button>
      </form>
    </div>

    <script>
      let taskData = JSON.parse(localStorage.getItem('taskData')) || { goals: [], projects: [], tasks: [] };

      function toggleForm(formId) {
        const form = document.getElementById(formId);
        form.classList.toggle('hidden');
        if (!form.classList.contains('hidden')) {
          if (formId === 'projectForm') {
            const select = document.getElementById('linkedGoal');
            select.innerHTML = '<option value="">No Goal</option>';
            taskData.goals.forEach(goal => {
              const option = document.createElement('option');
              option.value = goal.id;
              option.textContent = goal.title;
              select.appendChild(option);
            });
          } else if (formId === 'taskForm') {
            const select = document.getElementById('linkedProject');
            select.innerHTML = '<option value="">No Project</option>';
            taskData.projects.forEach(project => {
              const option = document.createElement('option');
              option.value = project.id;
              option.textContent = project.title;
              select.appendChild(option);
            });
          }
        }
      }

      function saveGoal() {
        const title = document.getElementById('goalTitle').value;
        const description = document.getElementById('goalDescription').value;
        const date = document.getElementById('goalDate').value;
        if (title) {
          const goal = { id: Date.now(), title, description: description || '', date: date || null };
          taskData.goals.push(goal);
          localStorage.setItem('taskData', JSON.stringify(taskData));
          toggleForm('goalForm');
          render();
        }
      }

      function saveProject() {
        const title = document.getElementById('projectTitle').value;
        const description = document.getElementById('projectDescription').value;
        const date = document.getElementById('projectDate').value;
        const linkedGoal = document.getElementById('linkedGoal').value;
        if (title) {
          const project = { id: Date.now(), title, description: description || '', date: date || null, linkedGoal: linkedGoal || null, progress: 0 };
          taskData.projects.push(project);
          localStorage.setItem('taskData', JSON.stringify(taskData));
          toggleForm('projectForm');
          render();
        }
      }

      function saveTask() {
        const title = document.getElementById('taskTitle').value;
        const date = document.getElementById('taskDate').value;
        const priority = document.getElementById('taskPriority').value;
        const type = document.getElementById('taskType').value;
        const linkedProject = document.getElementById('linkedProject').value;
        if (title) {
          const task = { id: Date.now(), title, date: date || null, priority, type, completed: false, linkedProject: linkedProject || null };
          taskData.tasks.push(task);
          localStorage.setItem('taskData', JSON.stringify(taskData));
          toggleForm('taskForm');
          render();
        }
      }

      function render() {
        document.getElementById('goals').innerHTML = taskData.goals.map(goal => `
          <div class="item">
            <h3>${goal.title}</h3>
            <p>${goal.description || 'No description'}</p>
            <span>${goal.date ? new Date(goal.date).toLocaleDateString() : 'No date'}</span>
            <button onclick="editItem('goal', ${goal.id})">Edit</button>
          </div>
        `).join('');
        document.getElementById('projects').innerHTML = taskData.projects.map(project => `
          <div class="item">
            <h3>${project.title}</h3>
            <p>${project.description || 'No description'}</p>
            <div class="progress"><div class="progress-bar" style="width: ${project.progress}%">${project.progress}%</div></div>
            <span>${project.date ? new Date(project.date).toLocaleDateString() : 'No date'}</span>
            <button onclick="editItem('project', ${project.id})">Edit</button>
          </div>
        `).join('');
        document.getElementById('tasks').innerHTML = taskData.tasks.map(task => `
          <div class="item">
            <h3>${task.title}</h3>
            <span>${task.date ? new Date(task.date).toLocaleDateString() : 'No date'} | ${task.priority} | ${task.type}</span>
            <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="task.completed = this.checked; localStorage.setItem('taskData', JSON.stringify(taskData)); render();">
            <button onclick="editItem('task', ${task.id})">Edit</button>
          </div>
        `).join('');
      }

      function editItem(type, id) {
        const item = taskData[`${type}s`].find(i => i.id === id);
        if (item) {
          document.getElementById(`${type}Title`).value = item.title;
          if (type !== 'task') document.getElementById(`${type}Description`).value = item.description || '';
          document.getElementById(`${type}Date`).value = item.date || '';
          if (type === 'project') document.getElementById('linkedGoal').value = item.linkedGoal || '';
          else if (type === 'task') {
            document.getElementById('taskPriority').value = item.priority;
            document.getElementById('taskType').value = item.type;
            document.getElementById('linkedProject').value = item.linkedProject || '';
          }
          toggleForm(`${type}Form`);
        }
      }

      function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(taskData));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "task-data.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
      }

      function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = e => {
            taskData = JSON.parse(e.target.result);
            localStorage.setItem('taskData', JSON.stringify(taskData));
            render();
          };
          reader.readAsText(file);
        };
        input.click();
      }

      render();
    </script>
</html>
