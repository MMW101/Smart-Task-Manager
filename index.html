<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="manifest" href="/manifest.json">
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4 text-center">Smart Task Manager</h1>

        <!-- Dashboard Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded shadow">
                <h2 class="text-xl font-semibold">Total Goals</h2>
                <p id="totalGoals" class="text-2xl">0</p>
            </div>
            <div class="bg-white p-4 rounded shadow">
                <h2 class="text-xl font-semibold">Total Projects</h2>
                <p id="totalProjects" class="text-2xl">0</p>
            </div>
            <div class="bg-white p-4 rounded shadow">
                <h2 class="text-xl font-semibold">Upcoming Items</h2>
                <p id="upcomingItems" class="text-2xl">0</p>
            </div>
        </div>

        <!-- Task Input -->
        <div class="mb-4">
            <input type="text" id="taskInput" class="w-full p-2 border rounded" placeholder="Enter a new task">
            <button onclick="addTask()" class="mt-2 bg-blue-500 text-white p-2 rounded">Add Task</button>
        </div>

        <!-- Task List -->
        <ul id="taskList" class="list-disc pl-5"></ul>

        <!-- Buttons Section -->
        <div class="mt-4">
            <button id="exportData" class="bg-green-500 text-white p-2 rounded mr-2">Export Data</button>
            <input type="file" id="importFile" class="p-2 border rounded" accept=".json">
            <button id="deleteAllData" class="bg-red-500 text-white p-2 rounded mr-2">Delete All Data</button>
            <button id="exportToCalendar" class="bg-purple-500 text-white p-2 rounded">Export to Calendar</button>
        </div>
    </div>

    <script>
        // Auto-update tasks on page load
        function autoUpdateTasks() {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            const today = new Date().toISOString().split('T')[0]; // e.g., "2025-07-22"
            
            const updatedTasks = tasks.map(task => {
                if (task.dueDate === today && task.status === 'active') {
                    task.dueDate = new Date(new Date().setDate(new Date(task.dueDate).getDate() + 1))
                        .toISOString().split('T')[0];
                }
                return task;
            });

            localStorage.setItem('tasks', JSON.stringify(updatedTasks));
            renderTasks(); // Refresh display
        }

        // Load and render tasks
        function renderTasks() {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'mb-2';
                li.innerHTML = `${task.title} (Due: ${task.dueDate}) 
                    <button onclick="toggleTask(${index})" class="ml-2 bg-yellow-500 text-white p-1 rounded">Toggle</button>
                    <button onclick="archiveTask(${index})" class="ml-2 bg-gray-500 text-white p-1 rounded">Archive</button>
                    <button onclick="deleteTask(${index})" class="ml-2 bg-red-500 text-white p-1 rounded">Delete</button>`;
                taskList.appendChild(li);
            });

            // Update dashboard stats
            document.getElementById('totalGoals').textContent = tasks.length;
            document.getElementById('totalProjects').textContent = tasks.filter(t => !t.isProject).length; // Adjust if needed
            document.getElementById('upcomingItems').textContent = tasks.filter(t => new Date(t.dueDate) > new Date()).length;
        }

        // Add new task
        function addTask() {
            const taskInput = document.getElementById('taskInput').value;
            if (taskInput) {
                const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                tasks.push({ title: taskInput, dueDate: new Date().toISOString().split('T')[0], status: 'active' });
                localStorage.setItem('tasks', JSON.stringify(tasks));
                document.getElementById('taskInput').value = '';
                renderTasks();
            }
        }

        // Toggle task status
        function toggleTask(index) {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            tasks[index].status = tasks[index].status === 'active' ? 'completed' : 'active';
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        // Archive task
        function archiveTask(index) {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            tasks[index].status = 'archived';
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        // Delete task
        function deleteTask(index) {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            tasks.splice(index, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        // Initial load
        window.onload = () => {
            autoUpdateTasks(); // Update tasks on load
            renderTasks();    // Display tasks
        };

        // Button functionalities (simplified placeholders)
        document.getElementById('exportData').addEventListener('click', () => {
            const data = localStorage.getItem('tasks');
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tasks.json';
            a.click();
        });

        document.getElementById('importFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    localStorage.setItem('tasks', event.target.result);
                    renderTasks();
                };
                reader.readAsText(file);
            }
        });

        document.getElementById('deleteAllData').addEventListener('click', () => {
            if (confirm('Are you sure?')) {
                localStorage.removeItem('tasks');
                renderTasks();
            }
        });

        document.getElementById('exportToCalendar').addEventListener('click', () => {
            alert('Export to Calendar functionality to be implemented');
        });
    </script>
</body>
</html>
